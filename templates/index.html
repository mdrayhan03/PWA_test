<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Flask App</title>

    <!-- Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">

    <!-- Theme color -->
    <meta name="theme-color" content="#0a74f7">

    <!-- Register Service Worker -->
    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("/service_worker.js")
            .then(() => console.log("Service Worker registered"))
            .catch(err => console.error("SW registration failed", err));
        }
    </script>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Hello! This is a PWA made with Flask!</h1>
    <button id="installBtn" style="display:none;">Install App</button>
</body>

<script>
let deferredPrompt;

window.addEventListener("beforeinstallprompt", (e) => {
    e.preventDefault();
    deferredPrompt = e;

    const btn = document.getElementById("installBtn");
    btn.style.display = "block";

    btn.addEventListener("click", () => {
        btn.style.display = "none";
        deferredPrompt.prompt();

        deferredPrompt.userChoice.then(() => {
            deferredPrompt = null;
        });
    });
});
</script>
</html>
